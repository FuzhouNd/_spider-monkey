// 巨潮网

// `http://www.cninfo.com.cn/new/announcement/download?bulletinId=${bulletinId}&announceTime=${announceTime}`
import download from 'download';
import fs from 'fs-extra';
import { delay } from '@/utils/index';
import { toText } from '@/pdf/index';
import glob from 'glob';
import path from 'path';

const keyWords = [
  '互联网金融',
  '信息化',
  '微信银行',
  '直销银行',
  '网络银行',
  '手机银行',
  '移动支付',
  '金融科技',
  '大数据',
  '云计算',
  '区块链',
  '人工智能',
  '智能化',
  '人脸识别',
  '生物识別',
  '移动互联',
];

const list = [
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1209484984',
    announcementTitle: '中国银行股份有限公司2020年年度报告',
    announcementTime: 1617120000000,
    adjunctUrl: 'finalpage/2021-03-31/1209484984.PDF',
    adjunctSize: 6421,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '010113||01010503||01030101',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1209484983',
    announcementTitle: '中国银行股份有限公司2020年年度报告摘要',
    announcementTime: 1617120000000,
    adjunctUrl: 'finalpage/2021-03-31/1209484983.PDF',
    adjunctSize: 654,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '010113||01010503||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1207419625',
    announcementTitle: '2019年年度报告摘要',
    announcementTime: 1585324800000,
    adjunctUrl: 'finalpage/2020-03-28/1207419625.PDF',
    adjunctSize: 591,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '010113||01030110||01010501',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1207419624',
    announcementTitle: '2019年年度报告',
    announcementTime: 1585324800000,
    adjunctUrl: 'finalpage/2020-03-28/1207419624.PDF',
    adjunctSize: 10472,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '010113||01030101||01010501',
    associateAnnouncement: '1207422469',
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1205968030',
    announcementTitle: '2018年年度报告摘要',
    announcementTime: 1553875200000,
    adjunctUrl: 'finalpage/2019-03-30/1205968030.PDF',
    adjunctSize: 571,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1205968029',
    announcementTitle: '2018年年度报告',
    announcementTime: 1553875200000,
    adjunctUrl: 'finalpage/2019-03-30/1205968029.PDF',
    adjunctSize: 2168,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030101',
    associateAnnouncement: '1205970175',
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1204547473',
    announcementTitle: 'H股公告-2017年年度报告',
    announcementTime: 1522339200000,
    adjunctUrl: 'finalpage/2018-03-30/1204547473.PDF',
    adjunctSize: 3061,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010503||010113||01030101',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1204547471',
    announcementTitle: '2017年年度报告',
    announcementTime: 1522339200000,
    adjunctUrl: 'finalpage/2018-03-30/1204547471.PDF',
    adjunctSize: 10497,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010503||010113||01030101',
    associateAnnouncement: '1204559865',
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1204547463',
    announcementTitle: '2017年年度报告摘要',
    announcementTime: 1522339200000,
    adjunctUrl: 'finalpage/2018-03-30/1204547463.PDF',
    adjunctSize: 611,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010503||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1203248032',
    announcementTitle: '2016年年度报告',
    announcementTime: 1490976000000,
    adjunctUrl: 'finalpage/2017-04-01/1203248032.PDF',
    adjunctSize: 10481,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010503||010113||01030101',
    associateAnnouncement: '1203248275',
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1203248029',
    announcementTitle: '2016年年度报告摘要',
    announcementTime: 1490976000000,
    adjunctUrl: 'finalpage/2017-04-01/1203248029.PDF',
    adjunctSize: 556,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010503||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1203248028',
    announcementTitle: 'H股公告-2016年年度报告',
    announcementTime: 1490976000000,
    adjunctUrl: 'finalpage/2017-04-01/1203248028.PDF',
    adjunctSize: 3109,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010503||010113||01030101',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1202113900',
    announcementTitle: '2015年年度报告',
    announcementTime: 1459353600000,
    adjunctUrl: 'finalpage/2016-03-31/1202113900.PDF',
    adjunctSize: 10356,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030101',
    associateAnnouncement: '1202116822',
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1202113897',
    announcementTitle: '2015年年度报告摘要',
    announcementTime: 1459353600000,
    adjunctUrl: 'finalpage/2016-03-31/1202113897.PDF',
    adjunctSize: 621,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1200742424',
    announcementTitle: 'H股-2014年年度报告',
    announcementTime: 1427299200000,
    adjunctUrl: 'finalpage/2015-03-26/1200742424.PDF',
    adjunctSize: 3063,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010503||010113||01030101',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1200741995',
    announcementTitle: '2014年年度报告',
    announcementTime: 1427299200000,
    adjunctUrl: 'finalpage/2015-03-26/1200741995.PDF',
    adjunctSize: 10243,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030101',
    associateAnnouncement: '1200744294',
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '1200741994',
    announcementTitle: '2014年年度报告摘要',
    announcementTime: 1427299200000,
    adjunctUrl: 'finalpage/2015-03-26/1200741994.PDF',
    adjunctSize: 607,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '63732016',
    announcementTitle: '2013年年度报告',
    announcementTime: 1395849600000,
    adjunctUrl: 'finalpage/2014-03-27/63732016.PDF',
    adjunctSize: 2002,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030101',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '63732015',
    announcementTitle: '2013年年度报告摘要',
    announcementTime: 1395849600000,
    adjunctUrl: 'finalpage/2014-03-27/63732015.PDF',
    adjunctSize: 549,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '62280177',
    announcementTitle: '2012年年度报告摘要',
    announcementTime: 1364313600000,
    adjunctUrl: 'finalpage/2013-03-27/62280177.PDF',
    adjunctSize: 550,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '62280176',
    announcementTitle: '2012年年度报告',
    announcementTime: 1364313600000,
    adjunctUrl: 'finalpage/2013-03-27/62280176.PDF',
    adjunctSize: 1843,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030101',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '60761024',
    announcementTitle: '2011年年度报告摘要',
    announcementTime: 1333060200000,
    adjunctUrl: 'finalpage/2012-03-30/60761024.PDF',
    adjunctSize: 1259,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302||251303',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '60761023',
    announcementTitle: '2011年年度报告',
    announcementTime: 1333060200000,
    adjunctUrl: 'finalpage/2012-03-30/60761023.PDF',
    adjunctSize: 2895,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302||251303',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030101',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '59485631',
    announcementTitle: '2010年年度报告补充公告',
    announcementTime: 1306535700000,
    adjunctUrl: 'finalpage/2011-05-28/59485631.PDF',
    adjunctSize: 140,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302||251303',
    pageColumn: 'SHZB',
    announcementType: '01010503||010113||01030130',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '59171242',
    announcementTitle: '2010年年度报告摘要',
    announcementTime: 1301005800000,
    adjunctUrl: 'finalpage/2011-03-25/59171242.PDF',
    adjunctSize: 1170,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302||251303',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030110',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
  {
    id: null,
    secCode: '601988',
    secName: '中国银行',
    orgId: 'jjxt0000028',
    announcementId: '59171241',
    announcementTitle: '2010年年度报告',
    announcementTime: 1301005800000,
    adjunctUrl: 'finalpage/2011-03-25/59171241.PDF',
    adjunctSize: 2326,
    adjunctType: 'PDF',
    storageTime: null,
    columnId: '250401||250402||251302||251303',
    pageColumn: 'SHZB',
    announcementType: '01010501||010113||01030101',
    associateAnnouncement: null,
    important: null,
    batchNum: null,
    announcementContent: '',
    orgName: null,
    announcementTypeName: null,
  },
];

async function downloadPdf(l: typeof list) {
  const tList = l.map((a) => {
    const bulletinId = (a.adjunctUrl || '').match(/([0-9A-Z]+)[.]PDF/)?.[1] || '';
    const announceTime = (a.adjunctUrl || '').match(/([0-9]+-[0-9]+-[0-9]+)/)?.[1] || '';
    return { bulletinId, announceTime, announcementTitle: a.announcementTitle };
  });
  for (const { bulletinId, announceTime, announcementTitle } of tList) {
    const buf = await download(`http://www.cninfo.com.cn/new/announcement/download?bulletinId=${bulletinId}&announceTime=${announceTime}`);
    fs.writeFileSync(`./data/${announcementTitle}.pdf`, buf);
    await delay(5 * 1000);
  }
}

async function getKeyWordCount(filePath: string, _keyWords = keyWords) {
  const text = await toText(filePath);
  return _keyWords.map((k) => {
    const reg = new RegExp(`${k}`, 'g');
    const count = text.match(reg)?.length || 0;
    return { count, word: k };
  });
}

(async () => {
  glob('./*.pdf', { cwd: './data' }, async (er, fileList) => {
    for (const filePath of fileList) {
      console.log(filePath);
      // const tList = await getKeyWordCount(filePath);
      // let fileName = path.parse(filePath).name;
      // if (!fileName.includes('中国银行')) {
      //   fileName = '中国银行' + fileName;
      // }
      // const p = tList
      //   .map(({ count, word }) => {
      //     return `${word} ${count}`;
      //   })
      //   .join(';');
      // fs.writeFileSync('./data/data.csv', `${fileName};${p}`, { flag: 'a' });
    }
  });
})();

// downloadPdf(
//   list.filter((l) => {
//     return !l.announcementTitle.includes('摘要');
//   })
// );
