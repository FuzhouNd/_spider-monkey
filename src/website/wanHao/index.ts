import fetch from 'node-fetch';
import fs from 'fs-extra';

const Cookie = `SECKEY_ABVK=hF4qj+mx8AZ9DvpFwQSvrEf/5s1lS5nG6/TD3EriQEw%3D; BMAP_SECKEY=cRDazFQYzYJY6sOHAVahf6YPhDj2mO0gsNruir3FaloIIlqAlwm_nay__d5h6Sav3H1O0tyqE3F0SELmewngiWhLVnrbdpsA6RoZwLOq84WP_Q--Tn73n6ByQAh5iWeLaVpw9axuWqWt_RALoDwhT4rYrN1Hjh5jiS05I1XEhd0YuSaQkcvgt5Gy-mdPZq7Q; sessionID=DFCBBB33-7B45-52A2-BFF3-0E8BA8B178CE; MI_Visitor=DFCBBB33-7B45-52A2-BFF3-0E8BA8B178CE; JVMID=aries-play-common-app-green-13-jtcf4; 7f43ca11c4dc21bb60196804ca3a8e4a=0f756b00539b8d3c7b6075445667cfa5; MI_SITE=prod16; x-mi-tag=rel-R22.8.1; 48e12f862218573e03bad597af586e4a=1909ca5c34ddc5d3096fe5d880b910b9; AKA_A2=A; 9bcb0189543e0c57619675a1e489dad6=00646728a517256e8c2ac4ba05b1e8bb; akacd_wwwprodcnfirst=3837283794~rv=29~id=be55b0bae3470d617fd91f29e8b559e4; ak_bmsc=97914ABB9BE206FC65A6A808BC885771~000000000000000000000000000000~YAAQ9RTSPPYk+WWCAQAAfGOjdRDEJ+DmjxJ90dmRo42rkHPY2xNE95USXoGH1t9Zgzc+Gdii0Dat/xa8SuCHyK2DsP+8v54eL1Yp0VlKdmlkEoqHiMQJqzrnWVC/e7vD/qJd23m4SnJMGM6ZDoYe9vtfC33tEYvC7INIFwterFKxq01SDjrV9b4dH5y42AzVmSWIm72Ndwrdk11rM84RIU+Dk1AybgAdqP5Daqz6PLIJeyfrblkUzAHDBZ2uCNGbgMpaPpDuCal8xIguedrU4irdzva+W+vitKrWQEmP9Q+doYU5CPwjJDHz54+T8g+zewq9eypL3z012OWb+16XjZtum8lmzcYZeFv0S2cwQ1LfNNDfTqlAuI32FEQkBlpbWvI8A2OL8DMwCk4TNZd0To8twk5MuruucpC/uZCGVtKpMcjqEJRDUfwm6A==; bm_mi=5D4FCF0BA613FB6860C57E758827DC8D~YAAQ9RTSPOEk+WWCAQAAflSjdRD3dKHjl/Ddj+fkIi7fBwV3b6lA+MQCDHkmRb90p81/n1Qh0cjsH3bVummsvDk2M1yLt5p2DQTy4i/ZWXCWprE0uwSq2eYB4SuTfxID6B0ae3sBkqIF08OK139xMnpM2rr00TEGrO8z7vOXYOCdYxislcrdtspoLoJu1ou+oAXaDKPrm+90XZaGAd6QdsHpd3jZ+b1+p/YBeEH40DPycyUUeMnLFvQ+DmhhuXPIX7hyhaq8wFPKhkZy6MU+bUl9rrSttRp9HsJfYIXyRgkt+w2ga5Ibf/1aOkpE1wSJRCPqV4MpRwMe9ljZPQ==~1; bm_sv=1FB6B040D5EC8DD51896DBA05FA54923~YAAQ9RTSPCMo+WWCAQAA1d+ndRAgNTK3qP6oJWdXgsi06g0I9LZ875wK5vSmOz49xFA2UK7uZ7YzWuHrLitJbaIkJvhr+loYy1m9xkQnAULjqPT80pAk21BLNzDfuYFbgacV2MVwc2vMk3vP7j1z02yWBzZN4n5imOj8xeBTj2ehw88jmsOgGvwrWEt/+7dE7FxH+9ZPSzV9JedcrwdzIEKB5+mKxVqPVZltGVaCrmL3p7gPzsA2QfK7t19v90u5FU7C3bVv~1; ZMz286iJ=f%3DA_V1p3WCAQAAt4BDn9GmbpHBewnRT8npRXLOGEaoFomZMg3fEQYWbXcuHvZ1AZkDo-icuG46wH8AAEB3AAAAAA%253D%253D%26b%3D-4mng92%26c%3DAAD0mXWCAQAAKZs6TeMdMD-HJmHbKYlgntB7ImvO7HlvY2qbjZ-2WGbsfZ6I%26d%3DABYAgACAAIAAgACAAQCftlhm7H2eiAAAAABrKlY4ADF2kR0zUTbM4UytNeu9S14%26z%3Dq%26a%3DPUvJfgdVCJJpwHqmXr9-cTkC%253DhCs; fd27248cb7b4d7d2f46111a6f4cff229=17a1c4208259d43299566b74cbc9846b; F8eh4Hwq=A8EUo3WCAQAALEwVFvOfh4nabsCKq4o7FdvXgaicvAoeGYHk8M03twyvD_L_AZkDo-icuG46wH8AAEB3AAAAAA; AMCV_664516D751E565010A490D4C%40AdobeOrg=1585540135%7CMCIDTS%7C19212%7CMCMID%7C03988130148958379533973243981058894801%7CMCAID%7CNONE%7CMCOPTOUT-1659838338s%7CNONE%7CMCAAMLH-1660435938%7C11%7CMCAAMB-1660435938%7Cj8Odv6LonN4r3an7LhD3WZrU1bUpAkFkkiY1ncBR96t2PTI%7CMCSYNCSOP%7C411-19219%7CvVersion%7C4.4.0; check=true; mbox=session#4d19a41728fa4cd2afa965a49c3080f5#1659832866|PC#4d19a41728fa4cd2afa965a49c3080f5.32_0#1723076111; ctBannerCounter=4; ctLastSessionID=DFCBBB33-7B45-52A2-BFF3-0E8BA8B178CE; 855f89e12f62018a955cfa5e05012eda=37c1eed7b5a9e670c267e0c11c13bbec; RT="z=1&dm=marriott.com.cn&si=127645d1-252d-421a-83a4-f155ef54a271&ss=l6ikirr6&sl=5&tt=1gqb&bcn=%2F%2F684d0d49.akstat.io%2F"; AMCVS_664516D751E565010A490D4C%40AdobeOrg=1; mboxEdgeCluster=32; mdLogger=false; kampyle_userid=499c-27a3-78fe-2d3d-1cf7-cece-67cf-6d66; kampyleUserSession=1659831017282; kampyleSessionPageCounter=5; kampyleUserSessionsCount=2; OptanonConsent=isGpcEnabled=0&datestamp=Sun+Aug+07+2022+08%3A15%3A10+GMT%2B0800+(%E4%B8%AD%E5%9B%BD%E6%A0%87%E5%87%86%E6%97%B6%E9%97%B4)&version=6.26.0&isIABGlobal=false&hosts=&consentId=a41d1bfd-8a4e-46f9-a4fd-0990ccc00da9&interactionCount=2&landingPath=NotLandingPage&groups=1%3A1%2C3%3A0%2C4%3A0%2C6%3A1&AwaitingReconsent=false&geolocation=CN%3B; _cls_v=8eb847c5-1363-4ff6-b91c-658f32df386d; _cls_s=b34984cf-b7d8-4944-87ec-44aa06caa8b7:0; s_tbm=true; s_tbm1=true; s_cc=true; aam_uuid=04273521383246431763982677999560041912; demdex=04273521383246431763982677999560041912; akacd_Hybrid=3837283813~rv=66~id=30014ea62f4f7db7454c1ebf37bb3e5d; akacd_RWASP-default-phased-release=3837283813~rv=78~id=91f0005f4c9bb0f6950460a3c085cc5a; at_check=true; kampyleUserPercentile=73.42746610518553; OptanonAlertBoxClosed=2022-08-07T00:10:17.363Z; SECKEY_ABVK=hF4qj+mx8AZ9DvpFwQSvrHpPK/OdM52akNHGfArIBPM%3D; 510658a4ae9addc5e67b55f9313cbbd4=22410824fe9bab53f94aed3010a9856d; BMAP_SECKEY=cRDazFQYzYJY6sOHAVahfyQfulSYkKC4hlh8J5NolaNq8ICpSbHAZiAIcnAQCtK4fv_m_-_k0D9XRjRimrmDhHfXo1YUUUXcVEbnbNKBRuiUgJUaPU1hp2RTj5nXZrlcGUUMuEVcuuKrZW_VpyaH9aMvio7OBfqjG1XwY8QibCX85mgHxkntwvKzm289SyCy; lastUserEvent={"id":"","class":"analytics-click js-is-roomkey-enabled m-button m-button-primary ","text":" æ¥æ¾éåº ","dataAttr":{"analytics":"{'location':'searchForm'}"},"event_type":"click","event_data":{"timeStamp":54491,"metaKey":false,"namespace":"","pageX":972,"pageY":258}}; s_sq=%5B%5BB%5D%5D; updatedSearchType=typed`

async function test() {
  const res = await fetch(
    'https://www.marriott.com.cn/search/submitSearch.mi?roomTypeCode=&destinationAddress.region=&recordsPerPage=20&autoSuggestItemType=&destinationAddress.types=locality%2Cpolitical&destinationAddress.latitude=36.0662299&propertyCode=&destinationAddress.stateProvinceShort=&isInternalSearch=true&destinationAddress.cityPopulation=&vsInitialRequest=false&searchType=InCity&destinationAddress.locality=&showAddressPin=&miniStoreFormSubmit=&destinationAddress.stateProvinceDisplayName=&destinationAddress.destinationPageDestinationAddress=&destinationAddress.stateProvince=%E5%B1%B1%E4%B8%9C%E7%9C%81&searchRadius=80467.2&singleSearchAutoSuggest=&destinationAddress.placeId=ChIJa_D4gtUPljUR8_JMYfqCTWE&is-hotelsnearme-clicked=false&destinationAddress.addressline1=&for-hotels-nearme=%E9%9D%A0%E8%BF%91&suggestionsPropertyCode=&pageType=editsearch&destinationAddress.country=CN&destinationAddress.name=&poiCity=&destinationAddress.countryShort=&poiName=&destinationAddress.address=%E4%B8%AD%E5%9B%BD%E5%B1%B1%E4%B8%9C%E7%9C%81%E9%9D%92%E5%B2%9B%E5%B8%82&search-countryRegion=&collapseAccordian=is-hidden&singleSearch=true&destinationAddress.cityPopulationDensity=&destinationAddress.secondaryText=Shandong%2C+China&destinationAddress.postalCode=&destinationAddress.city=%E9%9D%92%E5%B2%9B%E5%B8%82&destinationAddress.mainText=Qingdao&airportCode=&isTransient=true&destinationAddress.longitude=120.38299&initialRequest=false&destinationAddress.website=https%3A%2F%2Fmaps.google.com%2F%3Fq%3D%25E4%25B8%25AD%25E5%259B%25BD%25E5%25B1%25B1%25E4%25B8%259C%25E7%259C%2581%25E9%259D%2592%25E5%25B2%259B%25E5%25B8%2582%26ftid%3D0x35960fd582f8f06b%3A0x614d82fa614cf2f3&search-locality=&dimensions=0&keywords=&roomTypeCode=&propertyCode=&flexibleDateSearchRateDisplay=false&propertyName=&isSearch=true&marriottRewardsNumber=&isRateCalendar=false&incentiveType_Number=&incentiveType=&flexibleDateLowestRateMonth=&flexibleDateLowestRateDate=&marrOfferId=&isMultiRateSearch=&multiRateMaxCount=&multiRateCorpCodes=&useMultiRateRewardsPoints=&multiRateClusterCodes=&multiRateCorpCodesEntered=&lowestRegularRate=&js-location-nearme-values=&destinationAddress.destination=Qingdao%2C+Shandong%2C+China&fromToDate=2022-08-31&fromToDate_submit=2022-09-01&fromDate=2022-08-31&toDate=2022-09-01&toDateDefaultFormat=09%2F01%2F2022&fromDateDefaultFormat=08%2F31%2F2022&flexibleDateSearch=false&isHideFlexibleDateCalendar=false&t-start=2022-08-31&t-end=2022-09-01&lengthOfStay=1&roomCountBox=1+%E5%AE%A2%E6%88%BF&roomCount=1&guestCountBox=1+%E6%88%90%E4%BA%BA+%E6%AF%8F%E9%97%B4%E5%AE%A2%E6%88%BF&numAdultsPerRoom=1&childrenCountBox=0+%E5%84%BF%E7%AB%A5+%E6%AF%8F%E9%97%B4%E5%AE%A2%E6%88%BF&childrenCount=0&childrenAges=&clusterCode=none&corporateCode=',
    {
      // @ts-ignore
      credentials: 'include',
      headers: {
        Cookie,
        'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:104.0) Gecko/20100101 Firefox/104.0',
        Accept: 'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8',
        'Accept-Language': 'zh-CN,en-US;q=0.7,en;q=0.3',
        'Upgrade-Insecure-Requests': '1',
        Pragma: 'no-cache',
        'Cache-Control': 'no-cache',
        'Sec-Fetch-Dest': 'empty',
        'Sec-Fetch-Mode': 'cors',
        'Sec-Fetch-Site': 'same-origin',
      },
      referrer: 'https://www.marriott.com.cn/search/findHotels.mi',
      method: 'GET',
      mode: 'cors',
    }
  );
  const text = await res.text();
  fs.writeFileSync('./data/text.html', text, { flag: 'a' });
  // console.log(text);
}
test();
